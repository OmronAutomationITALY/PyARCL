<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PyARCL &mdash; PyARCL 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> PyARCL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">pyarcl</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyARCL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">PyARCL</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for PyARCL</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1"># PyARCL is a personal project of Marco Zangrandi, from OMRON Italy (OEE-IT)</span>
<span class="c1"># Contact me at marco.zangrandi@omron.com</span>
<span class="c1"># Jan 2022 - Dec 2022</span>
<span class="c1">##############################################################################</span>

<span class="c1">#%% Imports</span>

<span class="kn">import</span> <span class="nn">telnetlib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1">#%% Logger Setup</span>

<div class="viewcode-block" id="setup_logger"><a class="viewcode-back" href="../PyARCL.html#PyARCL.setup_logger">[docs]</a><span class="k">def</span> <span class="nf">setup_logger</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">log_file</span><span class="p">,</span> <span class="n">loglevel</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that generates a custom logger with custom filename in the logs folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">leveldict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
        <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span>
        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
        <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">loglevel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leveldict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;loglevel&quot; parameter must be either debug, info, warning, error or critical.&#39;</span><span class="p">)</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">leveldict</span><span class="p">[</span><span class="n">loglevel</span><span class="p">]</span>

    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">)</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;logs</span><span class="se">\\</span><span class="si">{</span><span class="n">log_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>        
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span></div>

<span class="n">generallog</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="s1">&#39;GeneralLog&#39;</span><span class="p">,</span> <span class="s1">&#39;GeneralLog.log&#39;</span><span class="p">)</span>

<span class="c1">#%% General Purpose Functions</span>

<div class="viewcode-block" id="sanitizelogmessage"><a class="viewcode-back" href="../PyARCL.html#PyARCL.sanitizelogmessage">[docs]</a><span class="k">def</span> <span class="nf">sanitizelogmessage</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sanitizes strings that need to be put inside the log.</span>

<span class="sd">    Function that takes a string that might be on multiple lines and makes it one </span>
<span class="sd">    line only.</span>
<span class="sd">    The function takes the string and checks if it ends with &quot;\\r\\n&quot;; if it does </span>
<span class="sd">    returns said string without &quot;\\r\\n&quot;, returns the original string otherwise.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">returnstrokeindices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">returnstrokeindices</span><span class="p">:</span>
         <span class="n">returnstrokeindices</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)]</span>
        <span class="c1">#  print(returnstrokeindices)</span>
    
    <span class="n">substrings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">returnstrokeindices</span><span class="p">:</span>
        <span class="n">first_substring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[1]: </span><span class="si">{</span><span class="n">string</span><span class="p">[:</span><span class="n">returnstrokeindices</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s1">;&#39;</span>
        <span class="n">substrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">first_substring</span><span class="p">)</span>
        
        <span class="k">if</span>  <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">returnstrokeindices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returnstrokeindices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">ith_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="si">}</span><span class="s1">]: </span><span class="si">{</span><span class="n">string</span><span class="p">[</span><span class="n">returnstrokeindices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">returnstrokeindices</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="si">}</span><span class="s1">;&#39;</span>
                <span class="n">substrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ith_string</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1"># print(repr(string[returnstrokeindices[-1]+2:]))</span>
        <span class="k">if</span> <span class="n">string</span><span class="p">[</span><span class="n">returnstrokeindices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">last_substring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">]: </span><span class="si">{</span><span class="n">string</span><span class="p">[</span><span class="n">returnstrokeindices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s1">;&#39;</span>
            <span class="n">substrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_substring</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substrings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">string</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">substrings</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">string</span>    </div>
    
<span class="c1"># Give &#39;sanitizelogmessage&#39; function a more usable alias</span>
<span class="n">slm</span> <span class="o">=</span> <span class="n">sanitizelogmessage</span>

<div class="viewcode-block" id="sendcommand"><a class="viewcode-back" href="../PyARCL.html#PyARCL.sendcommand">[docs]</a><span class="k">def</span> <span class="nf">sendcommand</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Sends an ARCL command to a mobile robot or fleet manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        command (:py:class:`str`): The command string to send to the server.</span>

<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Nothing</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># If a &#39;Robot&#39; or &#39;FleetManager&#39; object is passed to the function, their TL_obj</span>
    <span class="c1"># and logger are passed, otherwise use the standard one.</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">TL_obj</span><span class="o">.</span><span class="n">logger</span>
        <span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span><span class="o">.</span><span class="n">TL_obj</span>

    <span class="n">command_text</span> <span class="o">=</span> <span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
    <span class="c1"># Logging the sent message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sent &quot;</span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; to </span><span class="si">{</span><span class="n">TL_obj</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">TL_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command_text</span><span class="p">)</span></div>

<div class="viewcode-block" id="findline"><a class="viewcode-back" href="../PyARCL.html#PyARCL.findline">[docs]</a><span class="k">def</span> <span class="nf">findline</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">check_exceptions</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Searches for a line inside the Telnet server.</span>

<span class="sd">    Function that reads through the lines of a Telnet server until specified line </span>
<span class="sd">    is found inside the incoming messages; returns said message.</span>

<span class="sd">    Args:</span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        line (:py:class:`str`): String to search for in the incoming Telnet messages</span>

<span class="sd">        timeout (:py:class:`int`): Number of lines to go through until function is killed and</span>
<span class="sd">            an Exception is raised.</span>
<span class="sd">        </span>
<span class="sd">        check_exceptions (:py:class:`bool`): Boolean value that checks for exceptions in the</span>
<span class="sd">            ARCL command lines and raises the appropriated exception in case it finds one.</span>

<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (:py:class:`str`): String containing the message containing the searched line.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># If a &#39;Robot&#39; or &#39;FleetManager&#39; object is passed to the function, their TL_obj</span>
    <span class="c1"># and logger are passed, otherwise use the standard one.</span>
    <span class="k">if</span> <span class="n">TL_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">TL_obj</span><span class="o">.</span><span class="n">logger</span>
        <span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span><span class="o">.</span><span class="n">TL_obj</span>

    <span class="c1"># Logging the findline event</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Started reading lines from </span><span class="si">{</span><span class="n">TL_obj</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">, searching for &quot;</span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sel_line</span> <span class="o">=</span> <span class="n">readline</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sel_line</span><span class="p">:</span>
            <span class="c1"># Logging the line find</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Line found&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="c1"># Logging the findline exception</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;findline function timeout reached&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;String not found&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">check_exceptions</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Unknown command&#39;</span> <span class="ow">in</span> <span class="n">sel_line</span><span class="p">:</span>
                <span class="n">command_name</span> <span class="o">=</span> <span class="n">sel_line</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;findline function read &quot;</span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot; unknown command exception&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Read &quot;Unknown command </span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;CommandError&#39;</span> <span class="ow">in</span> <span class="n">sel_line</span><span class="p">:</span>
                <span class="n">command_name</span> <span class="o">=</span> <span class="n">sel_line</span><span class="p">[</span><span class="mi">14</span><span class="p">:]</span>
                <span class="n">err_desc_line</span> <span class="o">=</span> <span class="n">readline</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;CommandErrorDescription&#39;</span> <span class="ow">in</span> <span class="n">err_desc_line</span><span class="p">:</span>
                    <span class="n">err_desc</span> <span class="o">=</span> <span class="n">err_desc_line</span><span class="p">[</span><span class="mi">25</span><span class="p">:]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;findline function read error related to &quot;</span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot;, error description says &quot;</span><span class="si">{</span><span class="n">err_desc</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Command &quot;</span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot; returns error &quot;</span><span class="si">{</span><span class="n">err_desc</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;findline function read error related to &quot;</span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Command &quot;</span><span class="si">{</span><span class="n">command_name</span><span class="si">}</span><span class="s1">&quot; returns error&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sel_line</span></div>

<div class="viewcode-block" id="readline"><a class="viewcode-back" href="../PyARCL.html#PyARCL.readline">[docs]</a><span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Reads the current line of a Telnet server and returns said line.</span>

<span class="sd">    Args:</span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (:py:class:`str`): Line read.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">line</span> <span class="o">=</span> <span class="n">TL_obj</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
    <span class="c1"># Logging the read line</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Read &quot;</span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot; from </span><span class="si">{</span><span class="n">TL_obj</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="trimmer"><a class="viewcode-back" href="../PyARCL.html#PyARCL.trimmer">[docs]</a><span class="k">def</span> <span class="nf">trimmer</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function used to trim a string, allows for multiple input types.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Multi input type in &#39;start&#39;; since most feedbacks are of the kind &#39;Feedback: Data&#39;</span>
    <span class="c1"># then the default value of &#39;start&#39; is &#39;:&#39;. &#39;start&#39; can also be defined as an int</span>
    <span class="c1"># and in that case it is used as the starting point of the trimming.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">ind_i</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ind_i</span> <span class="o">=</span> <span class="n">start</span>

    <span class="c1"># Multi input type in &#39;end&#39;; since most feedbacks are of the kind &#39;Feedback: Data&#39;</span>
    <span class="c1"># then the default value of &#39;end&#39; is &#39;\r\n&#39; as the character for the new line.</span>
    <span class="k">if</span> <span class="n">end</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ind_o</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind_o</span> <span class="o">=</span> <span class="n">end</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ind_o</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># &#39;length&#39; is the character length to remove to the start of the trimmed</span>
    <span class="c1"># string. Since the typical feedback is of the likes of &#39;Feedback: Data&#39;</span>
    <span class="c1"># then &#39;length&#39; default value is 2. This way the &#39;: Data&#39; string gets</span>
    <span class="c1"># automatically trimmed to &#39;Data&#39;.</span>
    <span class="k">return</span> <span class="n">string</span><span class="p">[</span><span class="n">ind_i</span><span class="o">+</span><span class="n">length</span><span class="p">:</span><span class="n">ind_o</span><span class="p">]</span></div>

<div class="viewcode-block" id="find_nth"><a class="viewcode-back" href="../PyARCL.html#PyARCL.find_nth">[docs]</a><span class="k">def</span> <span class="nf">find_nth</span><span class="p">(</span><span class="n">haystack</span><span class="p">,</span> <span class="n">needle</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Finds the nth element index inside a container.</span>

<span class="sd">    Fuction used to find the nth occurrance of an element inside a container</span>
<span class="sd">    and returns its index. Taken by BitFlip response on StackOverflow </span>
<span class="sd">    (https://stackoverflow.com/questions/73902551).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">haystack</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">needle</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">haystack</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">needle</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">start</span></div>

<div class="viewcode-block" id="onofftobool"><a class="viewcode-back" href="../PyARCL.html#PyARCL.onofftobool">[docs]</a><span class="k">def</span> <span class="nf">onofftobool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Translates &#39;on&#39; or &#39;off&#39; to their boolean counterpart.</span>

<span class="sd">    Function that takes a string in input and returns a boolean based on whether </span>
<span class="sd">    the original string was &quot;on&quot; or &quot;off&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;broken&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Broken&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;String neither on or off&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="startserver"><a class="viewcode-back" href="../PyARCL.html#PyARCL.startserver">[docs]</a><span class="k">def</span> <span class="nf">startserver</span><span class="p">(</span><span class="n">HOST_IP</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">HOST_PORT</span> <span class="o">=</span> <span class="mi">7171</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function that creates a telnet object and sends the needed password through </span>
<span class="sd">    to open it. Standard function to use when opening a socket connection with PyARCL.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Logging the starting of the connection</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to start Telnet server on </span><span class="si">{</span><span class="n">HOST_IP</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">HOST_PORT</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">TL_obj</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">HOST_IP</span><span class="p">,</span> <span class="n">HOST_PORT</span><span class="p">)</span>
    <span class="n">TL_obj</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
    <span class="c1"># Logging the suffessful connection of the Telnet server</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Telnet server on </span><span class="si">{</span><span class="n">HOST_IP</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">HOST_PORT</span><span class="si">}</span><span class="s1"> started correctly&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TL_obj</span></div>

<span class="c1">#%% Multithreading Support Decorator</span>

<div class="viewcode-block" id="TLrequest"><a class="viewcode-back" href="../PyARCL.html#PyARCL.TLrequest">[docs]</a><span class="k">def</span> <span class="nf">TLrequest</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Decorator to handle mutex operations in multithreading access to Telnet server.</span>

<span class="sd">    This function is meant to be used as a decorator for the MasterAMR class </span>
<span class="sd">    and subclasses to allow for ordered multi-threading access to the</span>
<span class="sd">    Telnet textserver.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># Needed to correct docstring import...</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># This monstruosity of nested functions is needed to define a decorator</span>
    <span class="c1"># that has access to the &#39;self&#39; class object property, since a decorator</span>
    <span class="c1"># can only be defined as a function with single argument that only</span>
    <span class="c1"># returns a function.</span>
    <span class="c1"># &#39;TLrequestadj&#39; collects the &#39;self&#39; method and the various arguments of</span>
    <span class="c1"># &#39;request&#39; as *args, **kw. It&#39;s used to then create a zero-argument function</span>
    <span class="c1"># that is still able to call the original &#39;request&#39; correctly.</span>
    <span class="k">def</span> <span class="nf">TLrequestadj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        
        <span class="c1"># &#39;adjrequest&#39; is a function with zero arguments that represents the </span>
        <span class="c1"># original &#39;request&#39; call with its arguments intact. This is needed to </span>
        <span class="c1"># put it through a multithreading pool.</span>
        <span class="k">def</span> <span class="nf">adjrequest</span><span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="c1"># If &#39;request&#39; is called by a thread, save the original thread ID</span>
        <span class="n">originalthread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span>
        <span class="c1"># create the thread that will generate the &#39;request&#39; instance, then</span>
        <span class="c1"># put it in the queue</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">TelnetRequestThread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="n">adjrequest</span><span class="p">,</span> <span class="n">TL_requests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">originalthread</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
        
        <span class="c1"># Start the thread and wait for it to complete correctly</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="c1"># Remove the thread in the thread queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t1</span><span class="o">.</span><span class="n">returnvalue</span>
    
    <span class="c1"># Since the only returned value from &#39;TLrequest&#39; is a function it is</span>
    <span class="c1"># allowed to be used as a decorator</span>
    <span class="k">return</span> <span class="n">TLrequestadj</span></div>

<div class="viewcode-block" id="TelnetRequestThread"><a class="viewcode-back" href="../PyARCL.html#PyARCL.TelnetRequestThread">[docs]</a><span class="k">class</span> <span class="nc">TelnetRequestThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that describes a thread with custom mutex functionality.</span>

<span class="sd">    This class is meant to be used by the TLrequest function.</span>
<span class="sd">    Inherits most properties from the threading.Thread class.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># init method first calls needed actions from the parent class, then saves</span>
    <span class="c1"># a few variables to be used in the thread queue management</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">returnvalue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="c1"># The run function runs when the thread is first started </span>
<div class="viewcode-block" id="TelnetRequestThread.run"><a class="viewcode-back" href="../PyARCL.html#PyARCL.TelnetRequestThread.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Logging the current thread asking for Telnet access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;thread </span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span><span class="si">}</span><span class="s1"> requests access to Telnet&#39;</span><span class="p">)</span>
        <span class="c1"># &#39;TL_request&#39; thread elements are inspected one by one and joined by</span>
        <span class="c1"># the current thread. When the current thread sees itself in the list</span>
        <span class="c1"># it&#39;s its turn and it is allowed to access the Telnet textserver.</span>
        <span class="c1"># Only exception to this rule is if the current thread finds his parent</span>
        <span class="c1"># waiting for completition, in which case he goes first since the parent</span>
        <span class="c1"># is waiting for him to finish before moving on. This is used to avoid</span>
        <span class="c1"># otherwise inevitable deadlocks. Please note this only allows for 1-level</span>
        <span class="c1"># thread nesting.</span>
        <span class="c1"># &#39;TL_request&#39; is copied at the thread start to allow indexes to make </span>
        <span class="c1"># sense since the original list is modified all the time by popping</span>
        <span class="c1"># and adding elements.</span>
        
        <span class="n">localrequests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">threadidlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">ident</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">localrequests</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">localrequests</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">ident</span> <span class="o">==</span> <span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="ow">in</span> <span class="n">threadidlist</span><span class="p">:</span>
                <span class="n">originindex</span> <span class="o">=</span> <span class="n">threadidlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">ident</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">thread</span><span class="o">.</span><span class="n">ident</span> <span class="o">==</span> <span class="n">localrequests</span><span class="p">[</span><span class="n">originindex</span><span class="p">]</span><span class="o">.</span><span class="n">origin</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if the thread to wait for finishes and gets deleted before</span>
                <span class="c1"># the current thread is able to join it correctly, the</span>
                <span class="c1"># &#39;join&#39; method will raise an exception. In this case,</span>
                <span class="c1"># we can consider the thread to be finished and move along.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Logging the thread waiting for another thread to finish</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;thread </span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span><span class="si">}</span><span class="s1"> waiting for thread </span><span class="si">{</span><span class="n">thread</span><span class="o">.</span><span class="n">ident</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>
        
        <span class="c1"># Logging the Telnet server access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;thread </span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span><span class="si">}</span><span class="s1"> granted access to Telnet&#39;</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">returnvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>
        <span class="c1"># Logging the Telnet server leave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;thread </span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">()</span><span class="si">}</span><span class="s1"> exiting Telnet&#39;</span><span class="p">)</span></div></div>

<span class="c1">#%% Subclasses Definition</span>

<div class="viewcode-block" id="JobSegment"><a class="viewcode-back" href="../PyARCL.html#PyARCL.JobSegment">[docs]</a><span class="k">class</span> <span class="nc">JobSegment</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Class describing a job segment.</span>

<span class="sd">    This class describes a job segment, it is meant to be used to make other </span>
<span class="sd">    functions return JobSegment objects, not to be used by the user directly.</span>

<span class="sd">    Attributes:        </span>
<span class="sd">        id (:py:class:`str`): The job segment unique id.</span>

<span class="sd">        jobid (:py:class:`str`): The job id this job segment belongs to.</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">mapgoallist</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">TL_requests</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            id (:py:class:`str`): The job segment unique id.</span>

<span class="sd">            jobid (:py:class:`str`): The job id this job segment belongs to.</span>

<span class="sd">            mapgoallist (:py:class:`list` of :py:class:`str`): List containing the names of all the</span>
<span class="sd">                goals present in map.</span>

<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="n">jobid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span> <span class="o">=</span> <span class="n">mapgoallist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;string: Type of job segment. Can be either pickup or dropoff.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;PICKUP&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="c1"># Logging result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;Pickup&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; type&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;Pickup&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;DROPOFF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="c1"># Logging result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;Dropoff&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; type&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">&#39;Dropoff&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job Segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; type neither Pickup nor Dropoff&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;job segment id neither dropoff or pickup. This should not be happening; please report.&#39;</span><span class="p">)</span>

    <span class="c1"># The data items of a &#39;JobSegment&#39; object are priority, state, substate, </span>
    <span class="c1"># goal, assignedrobot, queuedtime, finishedtime and failnumber. All of </span>
    <span class="c1"># those are got by the same command over ARCL and are therefore parsed </span>
    <span class="c1"># by the same function. Then each of those items is assigned a property.</span>
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">_get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The &#39;info&#39; class is used only to generate the object that will</span>
        <span class="c1"># collect all the different information pieces, so that it might be</span>
        <span class="c1"># used easily for property declaration.</span>
        <span class="k">class</span> <span class="nc">info</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">substate</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">assignedrobot</span><span class="p">,</span> <span class="n">queuedtime</span><span class="p">,</span> <span class="n">finishedtime</span><span class="p">,</span> <span class="n">failnumber</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">substate</span> <span class="o">=</span> <span class="n">substate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">goal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assignedrobot</span> <span class="o">=</span> <span class="n">assignedrobot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queuedtime</span> <span class="o">=</span> <span class="n">queuedtime</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finishedtime</span> <span class="o">=</span> <span class="n">finishedtime</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">failnumber</span> <span class="o">=</span> <span class="n">failnumber</span>
        
        <span class="c1"># queuequery is the command that queries the jobsegment info based</span>
        <span class="c1"># on id. Response is of the form of &quot;QueueQuery: Data&quot;.</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;queuequery id </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;QueueQuery: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="n">priority</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">substate</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">goal</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">assignedrobot</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># &#39;queuedtime&#39; and &#39;finishedtime&#39; can be &quot;None&quot; as it might be that</span>
        <span class="c1"># the job is not assigned and/or not finished. This snippet of code</span>
        <span class="c1"># transforms the &quot;None&quot; string in the &#39;None&#39; Python object.</span>
        <span class="k">if</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">queuedtime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queued_time_str</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">1</span><span class="p">)[:</span><span class="mi">19</span><span class="p">]</span>
            <span class="n">queuedtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">queued_time_str</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">finishedtime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">finished_time_str</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">1</span><span class="p">)[:</span><span class="mi">19</span><span class="p">]</span>
            <span class="n">finishedtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">finished_time_str</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="n">failnumber</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Set the pointer to the &#39;EndQueueQuery&#39; line</span>
        <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;EndQueueQuery&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">info</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">substate</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">assignedrobot</span><span class="p">,</span> <span class="n">queuedtime</span><span class="p">,</span> <span class="n">finishedtime</span><span class="p">,</span> <span class="n">failnumber</span><span class="p">)</span>
    
    <span class="c1"># Defining get and set functions for property declaration</span>
    <span class="k">def</span> <span class="nf">_get_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;int: The priority value of the job segment.</span>

<span class="sd">        Can be set: Setting the priority to another value will result as such</span>
<span class="sd">        if the job segment is not completed yet.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment priority request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; priority&#39;</span><span class="p">)</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">priority</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">priority</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">priority</span>

    <span class="k">def</span> <span class="nf">_get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;string: The job state as described by ARAM.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment state request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; state&#39;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">state</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">_get_substate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;string: The job substate as described by ARAM.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; substate&#39;</span><span class="p">)</span>
        <span class="n">substate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">substate</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">substate</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">substate</span>

    <span class="k">def</span> <span class="nf">_get_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;string: The map goal the job segment is associated with.</span>

<span class="sd">        Can be set: Setting this goal to another in map will result as such</span>
<span class="sd">        if the job segment is not completed yet. Will raise an exception if</span>
<span class="sd">        the new goal does not exist in map. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; goal&#39;</span><span class="p">)</span>
        <span class="n">goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">goal</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">goal</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">goal</span>

    <span class="k">def</span> <span class="nf">_get_assignedrobot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;string: The unique id of the AMR that is assigned to the job segment.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; assignedrobot&#39;</span><span class="p">)</span>
        <span class="n">assignedrobot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">assignedrobot</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">assignedrobot</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">assignedrobot</span>

    <span class="k">def</span> <span class="nf">_get_queuedtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Datetime object: Time at which the job segment was successfully accepted </span>
<span class="sd">        by the AMR or FM queuing manager.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; queuedtime&#39;</span><span class="p">)</span>
        <span class="n">queuedtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">queuedtime</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">queuedtime</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queuedtime</span>

    <span class="k">def</span> <span class="nf">_get_finishedtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Datetime object: Time at which the job segment was completed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; finishedtime&#39;</span><span class="p">)</span>
        <span class="n">finishedtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">finishedtime</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">finishedtime</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">finishedtime</span>

    <span class="k">def</span> <span class="nf">_get_failnumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;int: Number of times the job segment has failed before.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the jobsegment type request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; failnumber&#39;</span><span class="p">)</span>
        <span class="n">failnumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span><span class="o">.</span><span class="n">failnumber</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">failnumber</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">failnumber</span>

    <span class="c1"># Goal and priority can be changed for a goal segment by using the</span>
    <span class="c1"># &quot;queuemodify&quot; ARCL command.</span>
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">_set_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newgoal</span><span class="p">):</span>
        <span class="c1"># Logging the jobsegment goal set attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to set job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; goal as &quot;</span><span class="si">{</span><span class="n">newgoal</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newgoal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span><span class="p">:</span>
                <span class="c1"># Logging the exception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempted to modify &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; goal to &quot;</span><span class="si">{</span><span class="n">newgoal</span><span class="si">}</span><span class="s1">&quot;, which is not present in map&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot modify job segment goal: Goal name not in map&#39;</span><span class="p">)</span> 
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;queuemodify </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> goal </span><span class="si">{</span><span class="n">newgoal</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">_set_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newpriority</span><span class="p">):</span>
        <span class="c1"># Logging the jobsegment priority set attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to set job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; priority as &quot;</span><span class="si">{</span><span class="n">newpriority</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;queuemodify </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"> priority </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">newpriority</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Dummy set function that does nothing. For property declaration.</span>
    <span class="k">def</span> <span class="nf">_set_any</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="c1"># Property declaration</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_priority</span><span class="p">,</span> <span class="n">_set_priority</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_state</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>
    <span class="n">substate</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_substate</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_goal</span><span class="p">,</span> <span class="n">_set_goal</span><span class="p">)</span>
    <span class="n">assignedrobot</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_assignedrobot</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>
    <span class="n">queuedtime</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_queuedtime</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>
    <span class="n">finishedtime</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_finishedtime</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>
    <span class="n">failnumber</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_failnumber</span><span class="p">,</span> <span class="n">_set_any</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">()</span>

        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        JobSegment: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            JobID:          </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            JobType:        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            Priority:       </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">priority</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            State:          </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            Substate:       </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">substate</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            Goal:           </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">goal</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            AssignedRobot:  </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">assignedrobot</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            QueuedTime:     </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">queuedtime</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            FinishedTime:   </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">finishedtime</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            FailNumber:     </span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">failnumber</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></div>

<div class="viewcode-block" id="Job"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Job">[docs]</a><span class="k">class</span> <span class="nc">Job</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Class describing a job.</span>
<span class="sd">    </span>
<span class="sd">    This class describes a job, mostly contains basic informations and a dictionary</span>
<span class="sd">    containing its segments. It is meant to be used by other functions to return a</span>
<span class="sd">    Job object, it is not meant to be used by the user.</span>
<span class="sd">    The :py:class:`~pyarcl.Job` object can be also used as it was a dictionary. When this happens, it</span>
<span class="sd">    defaults at pointing its :py:attr:`~pyarcl.Job.jobsegments` attribute.</span>
<span class="sd">    E.g. Job.jobSegments[jobsegmentname] and Job[jobsegmentname] are essentially </span>
<span class="sd">    the same thing.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        jobid (:py:class:`str`): The job unique id.</span>

<span class="sd">        idlist (:py:class:`list` of :py:class:`str`): List containing the names of all the job segments</span>
<span class="sd">            that the job possesses.</span>
<span class="sd">        </span>
<span class="sd">        jobSegments (:py:class:`~PyARCL.JobSegmentDict`): Container that can be used to access</span>
<span class="sd">            all the job segments this job possesses as JobSegment objects. Acts</span>
<span class="sd">            like a dictionary returning JobSegment objects.</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">JobSegmentDictObject</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            idlist (:py:class:`list` of :py:class:`str`): List containing the names of all the job segments</span>
<span class="sd">                that the job possesses.</span>

<span class="sd">            jobid (:py:class:`str`): The job unique id.</span>
<span class="sd">            </span>
<span class="sd">            jobSegmentDictObject (:py:class:`~PyARCL.JobSegmentDict`): Container that can be used</span>
<span class="sd">                to access all the job segments this job possesses as JobSegment </span>
<span class="sd">                objects. Acts like a dictionary returning JobSegment objects.</span>

<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span> <span class="o">=</span> <span class="n">idlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="n">jobid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobSegments</span> <span class="o">=</span> <span class="n">JobSegmentDictObject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
<div class="viewcode-block" id="Job.cancel"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Job.cancel">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;No arguments method that cancels the job.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the Job cancel attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to cancel job &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;queuecancel jobid </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">__getcompletition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobSegments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;Completed&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iscomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`bool`: Checks whether the job is completed or not.</span>

<span class="sd">        This is done by accessing the state of the last job segment and checking</span>
<span class="sd">        whether that is &#39;Completed&#39; or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the job completition request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot; completition&#39;</span><span class="p">)</span>
        <span class="n">completition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getcompletition</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">completition</span><span class="si">}</span><span class="s1">&quot; for job &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">completition</span>
    
    <span class="c1"># Assigned robot is always the same one, choosing one &#39;JobSegment&#39; object</span>
    <span class="c1"># is no different than choosing another.</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assignedrobot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`str`: Robot that is assigned to this job. This is done by checking the</span>
<span class="sd">        robot assigned to the last job segment.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the job completition request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot; assignedrobot&#39;</span><span class="p">)</span>
        <span class="n">assignedrobot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobSegments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">assignedrobot</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned &quot;</span><span class="si">{</span><span class="n">assignedrobot</span><span class="si">}</span><span class="s1">&quot; for job segment &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">assignedrobot</span>
    
    <span class="c1"># Following methods are intended to make the &#39;Job&#39; object act like the</span>
    <span class="c1"># &#39;self.jobSegments&#39; object when accessed directly</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobsegmentname</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobSegments</span><span class="p">[</span><span class="n">jobsegmentname</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Job: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    Completition: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iscomplete</span><span class="si">}</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span>

        <span class="n">description</span> <span class="o">+=</span> <span class="s1">&#39;    Job Segments:</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">):</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">]: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="c1"># Remove last unnecessary &#39;\r\n&#39;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">description</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobsegmentname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">jobsegmentname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jobsegment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">jobsegment</span></div>

<div class="viewcode-block" id="JobSegmentDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.JobSegmentDict">[docs]</a><span class="k">class</span> <span class="nc">JobSegmentDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Container acting as a dictionary that returns :py:class:`~PyARCL.JobSegment` objects.</span>
<span class="sd">    </span>
<span class="sd">    Class not meant to be used by the user. It is used to generate the :py:class:`~PyARCL.JobSegment`</span>
<span class="sd">    objects that are contained within the :py:class:`~PyARCL.Job` objects.</span>
<span class="sd">    This class behaves like a dictionary.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        jobid (:py:class:`str`): The job unique id.</span>

<span class="sd">        idlist (:py:class:`list` of :py:class:`str`): List containing the names of all the job segments</span>
<span class="sd">            that the job possesses.</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">mapgoallist</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            idlist (:py:class:`list` of :py:class:`str`): List containing the names of all the job segments</span>
<span class="sd">                that the job possesses.</span>

<span class="sd">            jobid (:py:class:`str`): The job unique id.</span>
<span class="sd">            </span>
<span class="sd">            mapgoallist (:py:class:`list` of :py:class:`str`): List containing the names of all the</span>
<span class="sd">                goals present in map.</span>

<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span> <span class="o">=</span> <span class="n">idlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span> <span class="o">=</span> <span class="n">jobid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span> <span class="o">=</span> <span class="n">mapgoallist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobsegmentid</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to access &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot; jobsegment &quot;</span><span class="si">{</span><span class="n">jobsegmentid</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jobsegmentid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested job segment id &quot;</span><span class="si">{</span><span class="n">jobsegmentid</span><span class="si">}</span><span class="s1">&quot; which is not between &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot; segments&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job segment id &quot;</span><span class="si">{</span><span class="n">jobsegmentid</span><span class="si">}</span><span class="s1">&quot; not between job &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="si">}</span><span class="s1">&quot; segments&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">JobSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">jobsegmentid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Job Segments:</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">):</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">]: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="c1"># Remove last unnecessary &#39;\r\n&#39;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">description</span>
    
    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobsegmentname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">jobsegmentname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jobsegment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idlist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">jobsegment</span></div>

<div class="viewcode-block" id="JobDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.JobDict">[docs]</a><span class="k">class</span> <span class="nc">JobDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Container acting as a dictionary that returns :py:class:`~PyARCL.Job` objects.</span>
<span class="sd">    </span>
<span class="sd">    Class not meant to be used by the user. It is used to make the queue property</span>
<span class="sd">    work for both the :py:class:`~PyARCL.Robot` and :py:class:`~PyARCL.FleetManager` classes.</span>
<span class="sd">    This class behaves like a dictionary. Note that thanks to the :py:class:`~PyARCL.JobSegment` class</span>
<span class="sd">    allowing to be accessed like a dictionary (defaulting to the :py:attr:`~PyARCL.Job.jobSegments`) object</span>
<span class="sd">    the grammar to access a single job segment can be nested.</span>
<span class="sd">    E.g. JobDictObject[jobname][jobsegmentname] is essentially identical to</span>
<span class="sd">    JobDictObject[jobname].jobsegments[jobsegmentname]</span>

<span class="sd">    Attributes:</span>
<span class="sd">        queuelist (:py:class:`list` of :py:class:`str`): List containing the names of all the jobs</span>
<span class="sd">            currently in the queue</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">queuelist</span><span class="p">,</span> <span class="n">mapgoallist</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            queuelist (:py:class:`list` of :py:class:`str`): List containing the names of all the job</span>
<span class="sd">                currently in the queue</span>

<span class="sd">            mapgoallist (:py:class:`list` of :py:class:`str`): List containing the names of all the</span>
<span class="sd">                goals present in map.</span>

<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span> <span class="o">=</span> <span class="n">queuelist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span> <span class="o">=</span> <span class="n">mapgoallist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobname</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to access &quot;</span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">&quot; job from the queue&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jobname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job &quot;</span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">&quot; not in queue&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Job &quot;</span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">&quot; not (or not anymore) in queue&#39;</span><span class="p">)</span>

        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;queuequery jobid </span><span class="si">{</span><span class="n">jobname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">idlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;QueueQuery&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndQueueQuery</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">idlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="n">tempdict</span> <span class="o">=</span> <span class="n">JobSegmentDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobname</span><span class="p">,</span> <span class="n">tempdict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queuelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span>

        <span class="n">fullcommand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="n">queuelist</span><span class="p">:</span>
            <span class="n">fullcommand</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;queuequery jobid </span><span class="si">{</span><span class="n">jobid</span><span class="si">}</span><span class="se">\n</span><span class="s1"> &#39;</span>
        <span class="c1"># Remove last un-needed space from the full command list</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="n">fullcommand</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Avoid sending command if &#39;queuelist&#39; is empty, which would result in</span>
        <span class="c1"># an empty command string &quot;&quot;</span>
        <span class="k">if</span> <span class="n">fullcommand</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullcommand</span><span class="p">)</span>
        
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Jobs:</span><span class="se">\r\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">jobid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">queuelist</span><span class="p">):</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">] </span><span class="si">{</span><span class="n">jobid</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;QueueQuery&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndQueueQuery</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        [</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">] </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">description</span>
    
    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">jobname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">job</span></div>

<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Class that describes a datastore parameter.</span>
<span class="sd">    </span>
<span class="sd">    This class describes a data parameter coming from datastore. It is not meant</span>
<span class="sd">    to be used by the user, instead it is meant to be used by the datastore functions.&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Both parameter instances need to be defined as belonging to a section</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">paramname</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">,</span> <span class="n">rawvalue</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectionname</span> <span class="o">=</span> <span class="n">sectionname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramname</span> <span class="o">=</span> <span class="n">paramname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawvalue</span> <span class="o">=</span> <span class="n">rawvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
    <span class="c1"># This function takes the string coming from the Telnet textserver</span>
    <span class="c1"># and converts them in either int, float or boolean</span>
    <span class="k">def</span> <span class="nf">__adjustvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">isint</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        
        <span class="k">def</span> <span class="nf">isfloat</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">isint</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isfloat</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Logging the getvalue attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to get &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">paramname</span><span class="si">}</span><span class="s1">&quot; value&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__adjustvalue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawvalue</span><span class="p">)</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Parameter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">paramname</span><span class="si">}</span><span class="s1"> returns value &quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># The set function is not defined as this class will be dedicated</span>
    <span class="c1"># to datastore parameters, who cannot be set. Config parameters,</span>
    <span class="c1"># who can be set, will redefine this function and make use of this</span>
    <span class="c1"># already existing infrastructure through inheritance.</span>
    <span class="k">def</span> <span class="nf">_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="c1"># I need to use this grammar to define the &#39;value&#39; property otherwise</span>
    <span class="c1"># the &#39;value&#39; property won&#39;t call the right &quot;newly defined&quot; function</span>
    <span class="c1"># when it is inherited.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(),</span> <span class="n">fset</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">newvalue</span><span class="p">))</span></div>

<div class="viewcode-block" id="ConfigParameter"><a class="viewcode-back" href="../PyARCL.html#PyARCL.ConfigParameter">[docs]</a><span class="k">class</span> <span class="nc">ConfigParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that describes a configuration parameter.</span>

<span class="sd">    This class describes a config. parameter; basically just inherits :py:class:`~PyARCL.Parameter` </span>
<span class="sd">    properties and implements a set function for the value property.</span>
<span class="sd">    This class is not meant to be used by the user. Instead it is meant to be used </span>
<span class="sd">    by the config functions.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">paramname</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">,</span> <span class="n">rawvalue</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectionname</span> <span class="o">=</span> <span class="n">sectionname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramname</span> <span class="o">=</span> <span class="n">paramname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawvalue</span> <span class="o">=</span> <span class="n">rawvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="c1"># Logging the set value attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to set </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">paramname</span><span class="si">}</span><span class="s1"> value to </span><span class="si">{</span><span class="n">newvalue</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ARCL server setup&#39;</span><span class="p">][</span><span class="s1">&#39;ArclConfig&#39;</span><span class="p">]:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;ArclConfig&quot; parameter is set to False. Cannot modify configuration values.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;ArclConfig&quot; parameter is set to False. Cannot modify configuration values.&#39;</span><span class="p">)</span>

        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;configstart&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;configadd Section </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sectionname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;configadd </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">paramname</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;configparse&#39;</span><span class="p">)</span>
        <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Configuration changed&#39;</span><span class="p">)</span></div>

<span class="c1"># This way of defining dictionaries allows for property laws to work</span>
<span class="c1"># correctly when retrieving data.</span>
<div class="viewcode-block" id="ParameterDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.ParameterDict">[docs]</a><span class="k">class</span> <span class="nc">ParameterDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dictionary of parameters that access the value property when accessing items.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Parameter name does not exist&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">newvalue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="SectionDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.SectionDict">[docs]</a><span class="k">class</span> <span class="nc">SectionDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that acts like a dictionary of configuration sections.</span>
<span class="sd">    </span>
<span class="sd">    This class acts like a dictionary, returning ParameterDict container objects </span>
<span class="sd">    full of :py:class:`~PyARCL.ConfigParameter` objects that fully describes an AMR or FM full config.</span>
<span class="sd">    This class it&#39;s not meant to be used by the user, instead it is meant to be</span>
<span class="sd">    used by the config property in the :py:class:`~PyARCL.FleetManager` and :py:class:`~PyARCL.Robot` objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        sectionlist (:py:class:`list` of :py:class:`str`): List containing the names of all the sections</span>
<span class="sd">            in the AMR or FM configuration.</span>
<span class="sd">        </span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionlist</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            sectionlist (:py:class:`list` of :py:class:`str`): List containing the names of all the sections</span>
<span class="sd">                in the AMR or FM configuration.</span>

<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span> <span class="o">=</span> <span class="n">sectionlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to request config section &quot;</span><span class="si">{</span><span class="n">sectionname</span><span class="si">}</span><span class="s1">&quot; values&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sectionname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Config section &quot;</span><span class="si">{</span><span class="n">sectionname</span><span class="si">}</span><span class="s1">&quot; not in config section list&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Config section &quot;</span><span class="si">{</span><span class="n">sectionname</span><span class="si">}</span><span class="s1">&quot; not in config section list&#39;</span><span class="p">)</span>
        
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;getConfigSectionValues </span><span class="si">{</span><span class="n">sectionname</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">paramlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">valuelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetConfigSectionValue&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetConfigSectionValues</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tempparam</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">tempparam</span><span class="p">:</span>
                    <span class="n">paramlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempparam</span><span class="p">)</span>
                    <span class="n">valuelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">tempparamdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paramlist</span><span class="p">,</span> <span class="n">valuelist</span><span class="p">):</span>
            <span class="n">tempparamdict</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConfigParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ParameterDict</span><span class="p">(</span><span class="n">tempparamdict</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sectionlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sectionlist</span><span class="p">:</span>
            <span class="n">fullcommand</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;getConfigSectionValues </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="se">\n</span><span class="s1"> &#39;</span>
        <span class="c1"># Remove last un-needed space from the full command list</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="n">fullcommand</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Avoid sending command if &#39;sectionlist&#39; is empty, which would result in</span>
        <span class="c1"># an empty command string &quot;&quot;</span>
        <span class="k">if</span> <span class="n">fullcommand</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullcommand</span><span class="p">)</span>

        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sectionlist</span><span class="p">:</span>
            <span class="n">paramlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">valuelist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetConfigSectionValue&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetConfigSectionValues</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tempparam</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">tempparam</span><span class="p">:</span>
                        <span class="n">paramlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempparam</span><span class="p">)</span>
                        <span class="n">valuelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Section: </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paramlist</span><span class="p">,</span> <span class="n">valuelist</span><span class="p">):</span>
                <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;   </span><span class="si">{</span><span class="n">parameter</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        
        <span class="c1"># Delete last unnecessary &#39;\r\n&#39;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">description</span>

    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sectionname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sectionname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">section</span></div>

<div class="viewcode-block" id="GroupDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.GroupDict">[docs]</a><span class="k">class</span> <span class="nc">GroupDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that acts like a dictionary of datastore groups.</span>
<span class="sd">    </span>
<span class="sd">    This class acts like a dictionary, returning :py:class:`~PyARCL.ParameterDict` container objects </span>
<span class="sd">    full of :py:class:`~PyARCL.Parameter` objects that fully describes an AMR or FM full datastore.</span>
<span class="sd">    This class it&#39;s not meant to be used by the user, instead it is meant to be</span>
<span class="sd">    used by the datastore property in the :py:class:`~PyARCL.FleetManager` and :py:class:`~PyARCL.Robot` objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        grouplist (:py:class:`list` of :py:class:`str`): List containing the names of all the groups</span>
<span class="sd">            in the AMR or FM datastore.</span>
<span class="sd">        </span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">grouplist</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            grouplist (:py:class:`list` of :py:class:`str`): List containing the names of all the groups</span>
<span class="sd">                in the AMR or FM datastore.</span>
<span class="sd">        </span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                    With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">            </span>
<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span> <span class="o">=</span> <span class="n">grouplist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to request datastore group &quot;</span><span class="si">{</span><span class="n">groupname</span><span class="si">}</span><span class="s1">&quot; values&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">groupname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Group &quot;</span><span class="si">{</span><span class="n">groupname</span><span class="si">}</span><span class="s1">&quot; not in datastore group list&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Group &quot;</span><span class="si">{</span><span class="n">groupname</span><span class="si">}</span><span class="s1">&quot; not in datastore group list&#39;</span><span class="p">)</span>

        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;getDataStoreGroupValues </span><span class="si">{</span><span class="n">groupname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">paramlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">valuelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetDataStoreGroupValues&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetDataStoreGroupValues</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tempparam</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tempparam</span><span class="p">):</span>
                    <span class="n">paramlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempparam</span><span class="p">)</span>
                    <span class="n">valuelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">tempparamdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paramlist</span><span class="p">,</span> <span class="n">valuelist</span><span class="p">):</span>
            <span class="n">tempparamdict</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ParameterDict</span><span class="p">(</span><span class="n">tempparamdict</span><span class="p">)</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grouplist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span>

        <span class="n">fullcommand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouplist</span><span class="p">:</span>
            <span class="n">fullcommand</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;getDataStoreGroupValues </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="se">\n</span><span class="s1"> &#39;</span>
        <span class="c1"># Remove last un-needed space from the full command list</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="n">fullcommand</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Avoid sending command if &#39;grouplist&#39; is empty, which would result in</span>
        <span class="c1"># an empty command string &quot;&quot;</span>
        <span class="k">if</span> <span class="n">fullcommand</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullcommand</span><span class="p">)</span>

        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;DataStore:</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouplist</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    Group: </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetDataStoreGroupValues&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetDataStoreGroupValues</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">paramname</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;        </span><span class="si">{</span><span class="n">paramname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">description</span>
    
    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">groupname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">group</span></div>

<div class="viewcode-block" id="Status"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Status">[docs]</a><span class="k">class</span> <span class="nc">Status</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Class describing informations about the robot status.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        aramstatus (:py:class:`str`): The status of the robot as described by ARAM</span>
<span class="sd">        </span>
<span class="sd">        location (:py:class:`list` of :py:class:`int`): List containing in order X Y and Heading</span>
<span class="sd">            of the robot current position.</span>
<span class="sd">        </span>
<span class="sd">        locscore (:py:class:`float`): The localization score of the robot. The value</span>
<span class="sd">            can go from 0 (worst) to 100 (best).</span>
<span class="sd">        </span>
<span class="sd">        temperature (:py:class:`float`): The CPU current temperature in Celsius degrees.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_string</span><span class="p">,</span> <span class="n">stateofcharge_string</span><span class="p">,</span> <span class="n">location_string</span><span class="p">,</span> <span class="n">localizationscore_string</span><span class="p">,</span> <span class="n">temperature_string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aramstatus</span> <span class="o">=</span> <span class="n">status_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateofcharge</span> <span class="o">=</span> <span class="n">stateofcharge_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locscore</span> <span class="o">=</span> <span class="n">localizationscore_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature_string</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        Status:</span>
<span class="s1">            Aram Status:         </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">aramstatus</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            State of Charge:     </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stateofcharge</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            Location:            X: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> [mm], Y: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> [mm], : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1"> [deg]</span>
<span class="s1">            Localization Score:  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">locscore</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            CPU Temperature:     </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></div>

<div class="viewcode-block" id="InputDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.InputDict">[docs]</a><span class="k">class</span> <span class="nc">InputDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that acts like a dictionary of input values.</span>

<span class="sd">    This class acts like a dictionary, returning input values when items are accessed.</span>
<span class="sd">    Input values are returned as booleans, True for on and False for off. The single</span>
<span class="sd">    input values can also be set, but this only works if the input value is actually</span>
<span class="sd">    an output having the type set as &quot;customAlsoInput&quot; in the AMR configuration.</span>
<span class="sd">    This class is not meant to be used by the user, instead it is meant to be</span>
<span class="sd">    accessed by the :py:attr:`~PyARCL.Robot.inputs` property of the :py:class:`~PyARCL.Robot` objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        inputlist (:py:class:`list` of :py:class:`str`): List containing all the names of the inputs.</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">            </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">inputlist</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            inputlist (:py:class:`list` of :py:class:`str`): List containing all the names of the inputs.</span>
<span class="sd">        </span>
<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>

<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span> <span class="o">=</span> <span class="n">inputlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputname</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to access input &quot;</span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&quot; value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inputname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input name &quot;</span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&quot; does not exist&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input name does not exist&#39;</span><span class="p">)</span>
        
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;inputquery </span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Input: </span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">inputvalue</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># NB you don&#39;t need to set pointer to &#39;EndInputQuery&#39; because</span>
        <span class="c1"># such message does not exists.</span>
        <span class="k">return</span> <span class="n">onofftobool</span><span class="p">(</span><span class="n">inputvalue</span><span class="p">)</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Logging the setitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to set input &quot;</span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&quot; value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inputname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input name &quot;</span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&quot; does not exist&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input name does not exist&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;outputon </span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;outputoff </span><span class="si">{</span><span class="n">inputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span>

        <span class="n">fullcommand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputlist</span><span class="p">:</span>
            <span class="n">fullcommand</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;inputquery </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="se">\n</span><span class="s1"> &#39;</span>
        <span class="c1"># Remove last un-needed space from the full command list</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="n">fullcommand</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Avoid sending command if &#39;inputlist&#39; is empty, which would result in</span>
        <span class="c1"># an empty command string &quot;&quot;</span>
        <span class="k">if</span> <span class="n">fullcommand</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullcommand</span><span class="p">)</span>

        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Inputs: </span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">inputlist</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Input: </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">inputvalue</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">inputvalue</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        
        <span class="k">return</span> <span class="n">description</span>
    
    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inputname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">input</span></div>

<div class="viewcode-block" id="OutputDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.OutputDict">[docs]</a><span class="k">class</span> <span class="nc">OutputDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class that acts like a dictionary of output values.</span>

<span class="sd">    This class acts like a dictionary, returning output values when items are accessed.</span>
<span class="sd">    Output values are returned as booleans, True for on and False for off. The single</span>
<span class="sd">    output values can also be set, and this affects the actual state of the output</span>
<span class="sd">    in the AMR.</span>
<span class="sd">    This class is not meant to be used by the user, instead it is meant to be</span>
<span class="sd">    accessed by the :py:attr:`~PyARCL.Robot.outputs` property of the :py:class:`~PyARCL.Robot` objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        outputlist (:py:class:`list` of :py:class:`str`): List containing all the names of the outputs.</span>

<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">            With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL_obj</span><span class="p">,</span> <span class="n">outputlist</span><span class="p">,</span> <span class="n">TL_requests</span><span class="p">,</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">                With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>

<span class="sd">            outputlist (:py:class:`list` of :py:class:`str`): List containing all the names of the outputs.</span>
<span class="sd">        </span>
<span class="sd">            TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">                access to the Telnet server.</span>

<span class="sd">            logger (:py:class:`~logging.Logger`): The logger to log to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">TL_obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span> <span class="o">=</span> <span class="n">outputlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="n">TL_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputname</span><span class="p">):</span>
        <span class="c1"># Logging the getitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to access output &quot;</span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&quot; value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outputname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input name &quot;</span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&quot; does not exist&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Output name does not exist&#39;</span><span class="p">)</span>
        
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;outputquery </span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Output: </span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">outputvalue</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># NB you don&#39;t need to set pointer to &#39;EndInputQuery&#39; because</span>
        <span class="c1"># such message does not exists.</span>
        <span class="k">return</span> <span class="n">onofftobool</span><span class="p">(</span><span class="n">outputvalue</span><span class="p">)</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Logging the setitem attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to set output &quot;</span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&quot; value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outputname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input name &quot;</span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&quot; does not exist&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Output name does not exist&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;outputon </span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;outputoff </span><span class="si">{</span><span class="n">outputname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outputlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span>

        <span class="n">fullcommand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputlist</span><span class="p">:</span>
            <span class="n">fullcommand</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;outputquery </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="se">\n</span><span class="s1"> &#39;</span>
        <span class="c1"># Remove last un-needed space from the full command list</span>
        <span class="n">fullcommand</span> <span class="o">=</span> <span class="n">fullcommand</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Avoid sending command if &#39;outputlist&#39; is empty, which would result in</span>
        <span class="c1"># an empty command string &quot;&quot;</span>
        <span class="k">if</span> <span class="n">fullcommand</span><span class="p">:</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullcommand</span><span class="p">)</span>

        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Outputs: </span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputlist</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Output: </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">outputvalue</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">outputvalue</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        
        <span class="k">return</span> <span class="n">description</span>
    
    <span class="c1"># Following methods are implemented to mimic a dictionary</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outputname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">output</span></div>

<div class="viewcode-block" id="RobotDict"><a class="viewcode-back" href="../PyARCL.html#PyARCL.RobotDict">[docs]</a><span class="k">class</span> <span class="nc">RobotDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This class is just a dictionary class with custom __repr__.</span>

<span class="sd">    This class is used by the :py:class:`~PyARCL.FleetManager`&#39;s :py:attr:`~PyARCL.robots` attribute, which is a dictionary</span>
<span class="sd">    of :py:class:`~PyARCL.Robot` objects. It&#39;s exactly equal to a dictionary with a custom representation</span>
<span class="sd">    method to make it readeable by humans.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Robots:</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: Robot </span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">IP_address</span><span class="si">}</span><span class="se">\r\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">description</span></div>
            

<span class="c1">#%% Main Classes Definiton</span>

<div class="viewcode-block" id="MasterAMR"><a class="viewcode-back" href="../PyARCL.html#PyARCL.MasterAMR">[docs]</a><span class="k">class</span> <span class="nc">MasterAMR</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Parent class of :py:class:`~PyARCL.Robot` and :py:class:`~PyARCL.FleetManager`, used for inheritance purposes.</span>

<span class="sd">    This class was create to store all properties and methods common for both the</span>
<span class="sd">    user classes &#39;:py:class:`~PyARCL.Robot`&#39; and &#39;:py:class:`~PyARCL.FleetManager`&#39;. Everything that can be used by both an</span>
<span class="sd">    EM or AMR is found inside here instead of duplicating everything in the two</span>
<span class="sd">    classes. Therefore, this class is absolutely not meant to be used by the user,</span>
<span class="sd">    instead it&#39;s just a parent class that is used for practicality purposes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        IP_address (:py:class:`str`): The IP address of the appliance, inserted as a string.</span>

<span class="sd">        password (:py:class:`str`): The user-created password of the ARCL Telnet server, as</span>
<span class="sd">            defined in MobilePlanner.</span>
<span class="sd">            **Default**: adept</span>
<span class="sd">        </span>
<span class="sd">        commport (:py:class:`int`): The port used by the appliance to communicate through ARCL.</span>
<span class="sd">            **Default**: 7171</span>
<span class="sd">        </span>
<span class="sd">        autostart (:py:class:`bool`): Flag that defines whether or not to &quot;autostart&quot; the object</span>
<span class="sd">            when the class is instantiated. It&#39;s True by default, setting it to</span>
<span class="sd">            False does not start the Telnet communication at object instantiation and</span>
<span class="sd">            should only be used for debugging purposes.</span>
<span class="sd">            **Default**: True</span>

<span class="sd">        TL_requests (:py:class:`list` of :py:class:`Thread`): List of threads that are requesting</span>
<span class="sd">            access to the Telnet server.</span>
<span class="sd">        </span>
<span class="sd">        TL_obj (:py:class:`~telnetlib.Telnet`): Telnet server to send the command to.</span>
<span class="sd">	        With PyARCL this can be done through the :py:func:`~PyARCL.startserver` function.</span>
<span class="sd">        </span>
<span class="sd">        logger (:py:class:`~logging.Logger`): The logger to log to. This is generated</span>
<span class="sd">            as the object is instantiated and is unique per-object.</span>
<span class="sd">        </span>
<span class="sd">        loglevel (:py:class:`str`): String that represents the log level requested for the object.</span>
<span class="sd">            Possible values are &#39;debug&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;critical&#39;.</span>
<span class="sd">            **Default**: INFO level.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IP</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;adept&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7171</span><span class="p">,</span> <span class="n">autostart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loglevel</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Args:</span>
<span class="sd">            IP (:py:class:`str`): The IP address of the appliance, inserted as a string.</span>

<span class="sd">            password (:py:class:`str`): The user-created password of the ARCL Telnet server, as</span>
<span class="sd">                defined in MobilePlanner.</span>
<span class="sd">                **Default**: adept</span>
<span class="sd">            </span>
<span class="sd">            port (:py:class:`int`): The port used by the appliance to communicate through ARCL.</span>
<span class="sd">                **Default**: 7171</span>
<span class="sd">            </span>
<span class="sd">            autostart (:py:class:`bool`): Flag that defines whether or not to &quot;autostart&quot; the object</span>
<span class="sd">                when the class is instantiated. It&#39;s True by default, setting it to</span>
<span class="sd">                False does not start the Telnet communication at object instantiation and</span>
<span class="sd">                should only be used for debugging purposes.</span>
<span class="sd">                **Default**: True</span>
<span class="sd">            </span>
<span class="sd">            loglevel (:py:class:`str`): String that represents the log level requested for the object.</span>
<span class="sd">                Possible values are &#39;debug&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;critical&#39;.</span>
<span class="sd">                **Default**: INFO level.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span> <span class="o">=</span> <span class="n">IP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commport</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>

        <span class="c1"># TL_request is the list of threads that asked access to the Telnet</span>
        <span class="c1"># textserver. Those thread need to be generated by the TelnetRequestThread</span>
        <span class="c1"># class and wait for each other to finish before accessing the textserver,</span>
        <span class="c1"># allowing for stable, multi-access read management.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">autostart</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span> <span class="o">=</span> <span class="n">startserver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commport</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setinitialvalues_</span><span class="p">()</span>
        <span class="c1"># Logging the Telnet connection confirmation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Telnet connection with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1"> started&#39;</span><span class="p">)</span>

        <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;End of commands</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># The &#39;setinitialvalues&#39; method is used by the MasterAMR subclasses to declare shared </span>
    <span class="c1"># lists and variables used by other methods</span>
    <span class="k">def</span> <span class="nf">_setinitialvalues_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">generallog</span>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getgoallist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;getgoals&#39;</span><span class="p">)</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># the &#39;readuntil&#39; function cannot be used here since &#39;Goal:&#39; and</span>
        <span class="c1"># &#39;End of goals&#39; do not share a common key.</span>
        <span class="c1"># This unfortunately generates a possible robustness problem if &#39;getgoals&#39;</span>
        <span class="c1"># command is not interpreted correctly by the object, since using &#39;readline&#39;</span>
        <span class="c1"># instead of &#39;findline&#39; means that no exception will be raised in case of</span>
        <span class="c1"># &quot;Unknown command&quot; or &quot;CommandError&quot; ARCL errors.</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">readline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;Goal:&#39;</span> <span class="ow">in</span> <span class="n">readstring</span><span class="p">:</span>
                <span class="n">goallist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;End of goals</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">goallist</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">goallist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing the names of all the goals present in map.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the goallist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested goallist&#39;</span><span class="p">)</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getgoallist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">goallist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">goallist</span>

<div class="viewcode-block" id="MasterAMR.queueMulti"><a class="viewcode-back" href="../PyARCL.html#PyARCL.MasterAMR.queueMulti">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">queueMulti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">missiongoallist</span><span class="p">,</span> <span class="n">typelist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prioritylist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">customjobid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;General-purpose method to generate complex jobs.</span>

<span class="sd">        Args:</span>
<span class="sd">            missiongoallist (:py:class:`list` of :py:class:`str`): list containing the goal sequence</span>
<span class="sd">                of the needed job segments. The list can contain any number of</span>
<span class="sd">                goals, with an upper limit of NEED_TO_CHECK.</span>
<span class="sd">                For easiness of use, this parameter can be inserted as a simple</span>
<span class="sd">                string; if that is the case, a simple pickup job is created.</span>
<span class="sd">            </span>
<span class="sd">            typelist (:py:class:`list` of :py:class:`str`): list containing the job segment type for</span>
<span class="sd">                each requested goal. the job segment type can be either &#39;Pickup&#39;</span>
<span class="sd">                or &#39;Dropoff&#39;.</span>
<span class="sd">                **Default**: If typelist is not specified, the job segment types</span>
<span class="sd">                are assumed to alternate between pickup and dropoff for all</span>
<span class="sd">                job segments.</span>
<span class="sd">                </span>
<span class="sd">            prioritylist (:py:class:`list` of :py:class:`int`): list containing the priorities for</span>
<span class="sd">                each job segment.</span>
<span class="sd">                **Default**: If prioritylist is not specified, the priorities for</span>
<span class="sd">                all job segment types are assumed to be the default as</span>
<span class="sd">                defined in the config.</span>
<span class="sd">            </span>
<span class="sd">            customjobid (:py:class:`str`): the custom id to give to the job.</span>
<span class="sd">                **Default**: The default names ARAM assigns to the jobs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queueMulti attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to use queueMulti for the goals </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">missiongoallist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">queuing_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Queuing Manager&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>

        <span class="n">default_pickup_priority</span> <span class="o">=</span> <span class="n">queuing_manager</span><span class="p">[</span><span class="s1">&#39;DefaultPickupPriority&#39;</span><span class="p">]</span>
        <span class="n">default_dropoff_priority</span> <span class="o">=</span> <span class="n">queuing_manager</span><span class="p">[</span><span class="s1">&#39;DefaultDropoffPriority&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">missiongoallist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">missiongoallist</span> <span class="o">=</span> <span class="p">[</span><span class="n">missiongoallist</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">missiongoallist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">missiongoallist</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoallist&quot; parameter must be either a list of strings or a string&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoallist&quot; parameter must be either a list of strings or a string&#39;</span><span class="p">)</span>

        <span class="c1"># For speed reasons &#39;self.goallist&#39; is assigned by reference to &#39;goallist&#39;</span>
        <span class="c1"># local variable.</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">missiongoal</span> <span class="ow">in</span> <span class="n">goallist</span> <span class="k">for</span> <span class="n">missiongoal</span> <span class="ow">in</span> <span class="n">missiongoallist</span><span class="p">):</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Some or all mission goals are not present in map&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some or all mission goals are not present in map&#39;</span><span class="p">)</span>

        <span class="n">ngoals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missiongoallist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typelist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if typelist is not specified, then the order of pickup-dropoff</span>
            <span class="c1"># operations is chosen arbitrarily to be pickup-dropoff-pickup-dropoff</span>
            <span class="c1"># et cetera.</span>
            <span class="n">typelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pickup&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;Dropoff&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ngoals</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">prioritylist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prioritylist</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_pickup_priority</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Pickup&#39;</span> <span class="k">else</span> <span class="n">default_dropoff_priority</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">typelist</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typelist</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngoals</span> <span class="o">&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="n">prioritylist</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ngoals</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error: Vector lengths do not match&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error: Vector lengths do not match&#39;</span><span class="p">)</span>

        <span class="c1"># Sending the actual command</span>
        <span class="n">commandstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;queuemulti </span><span class="si">{</span><span class="n">ngoals</span><span class="si">}</span><span class="s1"> 2&#39;</span>
        <span class="k">for</span> <span class="n">missiongoal</span><span class="p">,</span> <span class="n">typology</span><span class="p">,</span> <span class="n">priority</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">missiongoallist</span><span class="p">,</span> <span class="n">typelist</span><span class="p">,</span> <span class="n">prioritylist</span><span class="p">):</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">typology</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">priority</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">customjobid</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">customjobid</span><span class="si">}</span><span class="s1">&#39;</span>
        
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandstring</span><span class="p">)</span>
        
        <span class="c1"># Reading feedback and using it to generate a dictionary of &#39;JobSegment&#39; objects</span>
        <span class="n">idlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;QueueMulti&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndQueueMulti</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
            <span class="n">idlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">jobid</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>

        <span class="c1"># Note how &#39;self.goallist&#39; and &#39;self.TL_requests&#39; are passed by reference:</span>
        <span class="c1"># - &#39;goallist&#39; will be always updated as it calls the property of the original object</span>
        <span class="c1"># - &#39;TL_requests&#39; for the @TLrequest decorator will be the one of the original object (!!!)</span>
        
        <span class="n">tempdict</span> <span class="o">=</span> <span class="n">JobSegmentDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">tempdict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

<div class="viewcode-block" id="MasterAMR.queuePickup"><a class="viewcode-back" href="../PyARCL.html#PyARCL.MasterAMR.queuePickup">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">queuePickup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">missiongoal</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">customjobid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generates a pickup mission to the AMR/FM and returns the :py:class:`~PyARCL.Job` object </span>
<span class="sd">        related to said mission.</span>

<span class="sd">        Args:</span>
<span class="sd">            missiongoal (:py:class:`str`): The mission goal the pickup job segment should</span>
<span class="sd">                be requesting.</span>
<span class="sd">        </span>
<span class="sd">            priority (:py:class:`int`): The priority of the pickup job segment.</span>
<span class="sd">                **Default**: The default pickup priority as defined in config.</span>
<span class="sd">            </span>
<span class="sd">            customjobid (:py:class:`str`): the custom id to give to the job.</span>
<span class="sd">                **Default**: The default names ARAM assigns to the jobs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queuePickup attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to use queuePickup for the goal &quot;</span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">default_pickup_priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Queuing Manager&#39;</span><span class="p">][</span><span class="s1">&#39;DefaultPickupPriority&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">missiongoal</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoal&quot; parameter must be a string&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoal&quot; parameter must be a string&#39;</span><span class="p">)</span>

        <span class="c1"># For speed reasons &#39;self.goallist&#39; is assigned by reference to &#39;goallist&#39;</span>
        <span class="c1"># local variable.</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span>
        <span class="k">if</span> <span class="n">missiongoal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goallist</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Goal &quot;</span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&quot; not in map&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Goal &quot;</span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&quot; not in map&#39;</span><span class="p">)</span>

        <span class="n">commandstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;queuepickup </span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">priority</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">customjobid</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">priority</span><span class="p">:</span>
                 <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">default_pickup_priority</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">customjobid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandstring</span><span class="p">)</span>
        
        <span class="c1"># Reading feedback and using it to generate a dictionary of &#39;JobSegment&#39; objects</span>

        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;queuepickup&#39;</span><span class="p">)</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">idlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">jobid</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>

        <span class="n">tempdict</span> <span class="o">=</span> <span class="n">JobSegmentDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">tempdict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="MasterAMR.queuePickupDropoff"><a class="viewcode-back" href="../PyARCL.html#PyARCL.MasterAMR.queuePickupDropoff">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">queuePickupDropoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">missiongoal1</span><span class="p">,</span> <span class="n">missiongoal2</span><span class="p">,</span> <span class="n">priority1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">priority2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">customjobid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generates a simple pickup-dropoff mission to the AMR/FM and returns the</span>
<span class="sd">        :py:class:`~PyARCL.Job` object related to said mission.</span>

<span class="sd">        Args:</span>
<span class="sd">            missiongoal1 (:py:class:`str`): The mission goal related to the pickup </span>
<span class="sd">                job segment.</span>

<span class="sd">            missiongoal2 (:py:class:`str`): The mission goal related to the dropoff </span>
<span class="sd">                job segment.</span>
<span class="sd">            </span>
<span class="sd">            priority1 (:py:class:`int`): The priority of the pickup job segment.</span>
<span class="sd">                **Default**: The default pickup priority as defined in config.</span>
<span class="sd">            </span>
<span class="sd">            priority2 (:py:class:`int`): The priority of the dropoff job segment.</span>
<span class="sd">                **Default**: The default dropoff priority as defined in config.</span>
<span class="sd">            </span>
<span class="sd">            customjobid (:py:class:`str`): the custom id to give to the job.</span>
<span class="sd">                **Default**: The default names ARAM assigns to the jobs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queuePickupDropoff attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to use queuePickupDropoff for the goals &quot;</span><span class="si">{</span><span class="n">missiongoal1</span><span class="si">}</span><span class="s1">&quot; and &quot;</span><span class="si">{</span><span class="n">missiongoal2</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">queuing_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Queuing Manager&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>

        <span class="n">default_pickup_priority</span> <span class="o">=</span> <span class="n">queuing_manager</span><span class="p">[</span><span class="s1">&#39;DefaultPickupPriority&#39;</span><span class="p">]</span>
        <span class="n">default_dropoff_priority</span> <span class="o">=</span> <span class="n">queuing_manager</span><span class="p">[</span><span class="s1">&#39;DefaultDropoffPriority&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="n">missiongoal1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">missiongoal2</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Both &quot;missiongoal&quot; parameters must be a string&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Both &quot;missiongoal&quot; parameters must be a string&#39;</span><span class="p">)</span>

        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">missiongoal1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goallist</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">missiongoal2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goallist</span><span class="p">):</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Either or both mission goals are not in map&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Either or both mission goals are not in map&#39;</span><span class="p">)</span>

        <span class="n">commandstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;queuepickupdropoff </span><span class="si">{</span><span class="n">missiongoal1</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">missiongoal2</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1"># This time both priorities need to be specified or we wouldn&#39;t</span>
        <span class="c1"># have the possibility to only customize one of them.</span>
        <span class="k">if</span> <span class="n">priority1</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">priority1</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">default_pickup_priority</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">priority2</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">priority2</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">default_dropoff_priority</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">customjobid</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">customjobid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandstring</span><span class="p">)</span>
        
        <span class="c1"># Reading feedback and using it to generate a dictionary of &#39;JobSegment&#39; objects</span>
        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;queuepickupdropoff&#39;</span><span class="p">)</span>

        <span class="n">id1</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
        <span class="n">idlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">]</span>
        <span class="n">jobid</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

        <span class="n">tempdict</span> <span class="o">=</span> <span class="n">JobSegmentDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">tempdict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getqueuelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">commandstring</span> <span class="o">=</span> <span class="s1">&#39;queueshow&#39;</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandstring</span><span class="p">)</span>

        <span class="n">queuelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;QueueShow&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndQueueShow</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">jobid</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">jobid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">queuelist</span><span class="p">:</span>
                <span class="n">queuelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jobid</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">queuelist</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">queuelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing the names of all the jobs in the queue;</span>
<span class="sd">        whether those are in progress, completed or cancelled.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queuelist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested queuelist&#39;</span><span class="p">)</span>
        <span class="n">queuelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getqueuelist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">queuelist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queuelist</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getqueue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">queuelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queuelist</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span>

        <span class="k">return</span> <span class="n">JobDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">queuelist</span><span class="p">,</span> <span class="n">goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">queue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`~PyARCL.JobDict`: Container acting like a dictionary of :py:class:`~PyARCL.JobDict` objects.</span>
<span class="sd">        Keys are the unique ids of the jobs, which can be accessed through the</span>
<span class="sd">        :py:attr:`~PyARCL.MasterAMR.queuelist` property. Allows iteration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queuelist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested queue&#39;</span><span class="p">)</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getqueue</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">queue</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queue</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getconfigsectionlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;getConfigSectionList&#39;</span><span class="p">)</span>

        <span class="n">sectionlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetConfigSectionList&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetConfigSectionList</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sectionlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">sectionlist</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sectionlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing the names of all the sections</span>
<span class="sd">        in the AMR or FM configuration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the sectionlist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested sectionlist&#39;</span><span class="p">)</span>
        <span class="n">configsectionlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getconfigsectionlist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">configsectionlist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configsectionlist</span>
    
    <span class="c1"># Great part of this code was shamelessly stripped from &quot;__getqueue&quot;</span>
    <span class="k">def</span> <span class="nf">__getconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>         
        <span class="n">sectiondict</span> <span class="o">=</span> <span class="n">SectionDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sectionlist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sectiondict</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`~PyARCL.SectionDict`: Container acting like a dictionary of </span>
<span class="sd">        :py:class:`~PyARCL.ParameterDict` objects. Keys are the names of the sections, which can</span>
<span class="sd">        be accessed through the :py:class:`~PyARCL.MasterAMR.sectionlist` property. Allows iteration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the config request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested config&#39;</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getconfig</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getdatastoregrouplist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;getDataStoreGroupList&#39;</span><span class="p">)</span>

        <span class="n">sectionlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;GetDataStoreGroupList&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;EndOfGetDataStoreGroupList</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sectionlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">sectionlist</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grouplist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing the names of all the groups in the AMR </span>
<span class="sd">        or FM datastore.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the grouplist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested grouplist&#39;</span><span class="p">)</span>
        <span class="n">datastoregrouplist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getdatastoregrouplist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datastoregrouplist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datastoregrouplist</span>
            
    <span class="k">def</span> <span class="nf">__getdatastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">groupdict</span> <span class="o">=</span> <span class="n">GroupDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouplist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">groupdict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`~PyARCL.GroupDict`: Container acting like a dictionary of </span>
<span class="sd">        :py:class:`~PyARCL.ParameterDict` objects. Keys are the names of the groups, which can</span>
<span class="sd">        be accessed through the :py:class:`~PyARCL.MasterAMR.grouplist` property. Allows iteration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the datastore request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested datastore&#39;</span><span class="p">)</span>
        <span class="n">datastore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getdatastore</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datastore</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datastore</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getdatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;getdatetime&#39;</span><span class="p">)</span>
        <span class="n">datetime_str</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;DateTime:&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datetime_str</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %H:%M:%S&#39;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`~datetime.datetime`: get current time of the client in DateTime</span>
<span class="sd">        time format.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the datetime request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested datetime&#39;</span><span class="p">)</span>
        <span class="n">RTC_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getdatetime</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RTC_time</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RTC_time</span>
    
<div class="viewcode-block" id="MasterAMR.tripReset"><a class="viewcode-back" href="../PyARCL.html#PyARCL.MasterAMR.tripReset">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">tripReset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sends the tripReset command to the Robot / FleetManager object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tripreset&#39;</span><span class="p">)</span>
        <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;EndOfTripReset&#39;</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="FleetManager"><a class="viewcode-back" href="../PyARCL.html#PyARCL.FleetManager">[docs]</a><span class="k">class</span> <span class="nc">FleetManager</span><span class="p">(</span><span class="n">MasterAMR</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class describing a Fleet Manager system.</span>

<span class="sd">    This class is the class the user should use to communicate with a Fleet Manager,</span>
<span class="sd">    usually running on an Enterprise Manager appliance. Use the FleetManager objects</span>
<span class="sd">    to access configuration, datastore, job queue and other useful data or to request</span>
<span class="sd">    new jobs and modify configuration parameters (Config change possible only on FC&lt;2.1).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        IP_address (:py:class:`str`): The IP address of the appliance, inserted as a string.</span>

<span class="sd">        password (:py:class:`str`): The user-created password of the ARCL Telnet server, as</span>
<span class="sd">            defined in MobilePlanner.</span>
<span class="sd">            **Default**: adept</span>
<span class="sd">        </span>
<span class="sd">        commport (:py:class:`int`): The port used by the appliance to communicate through ARCL.</span>
<span class="sd">            **Default**: 7171</span>

<span class="sd">        loglevel (:py:class:`str`): String that represents the log level requested for the object.</span>
<span class="sd">            Possible values are &#39;debug&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;critical&#39;.</span>
<span class="sd">            **Default**: INFO level.</span>

<span class="sd">        robots (:py:class:`dict` of :py:class:`~PyARCL.Robot`): by using the :py:meth:`~PyARCL.FleetManager.attachRobot` method one</span>
<span class="sd">            can add Robot objects to this dictionary, which indexes the Robot objects</span>
<span class="sd">            by their unique ids. Used to easy automation of access to the :py:class:`~PyARCL.Robot`</span>
<span class="sd">            objects on job-observation related scripts.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># The &#39;robots&#39; parameter can be used through the &#39;attachRobot&#39; method</span>
    <span class="c1"># to enter them in a dictionary, so that they might be accessed through</span>
    <span class="c1"># their identifier.</span>
    <span class="k">def</span> <span class="nf">_setinitialvalues_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robots</span> <span class="o">=</span> <span class="n">RobotDict</span><span class="p">({})</span>
        
        <span class="n">lastIPdigits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="p">[</span><span class="n">find_nth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FleetManagerLog_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;FM</span><span class="si">{</span><span class="n">lastIPdigits</span><span class="si">}</span><span class="s1">.log&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="p">)</span>

<div class="viewcode-block" id="FleetManager.attachRobot"><a class="viewcode-back" href="../PyARCL.html#PyARCL.FleetManager.attachRobot">[docs]</a>    <span class="k">def</span> <span class="nf">attachRobot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AMR</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Attaches a :py:class:`~PyARCL.Robot` object to the robots dictionary attribute.</span>

<span class="sd">            Args:</span>
<span class="sd">                AMR (:py:class:`~PyARCL.Robot`): The :py:class:`~PyARCL.Robot` object to add to the :py:attr:`~PyARCL.FleetManager.robots` attribute.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the robot attachment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to attach robot&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">AMR</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Robot</span><span class="p">:</span>
            <span class="c1"># Logging the exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;AMR argument is not a Robot object&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;AMR argument is not a Robot object&#39;</span><span class="p">)</span>

        <span class="n">robotID</span> <span class="o">=</span> <span class="n">AMR</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Enterprise Manager Connection&#39;</span><span class="p">][</span><span class="s1">&#39;Identifier&#39;</span><span class="p">]</span>
        <span class="c1"># Logging the attachment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to attach robot &quot;</span><span class="si">{</span><span class="n">robotID</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">[</span><span class="n">robotID</span><span class="p">]</span> <span class="o">=</span> <span class="n">AMR</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">[</span><span class="s1">&#39;Versions&#39;</span><span class="p">]</span>
        <span class="n">queueinformation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">[</span><span class="s1">&#39;QueueInformation&#39;</span><span class="p">]</span>
        <span class="n">jobcounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">[</span><span class="s1">&#39;JobCounts&#39;</span><span class="p">]</span>
        <span class="n">fleetrobotinformation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">[</span><span class="s1">&#39;FleetRobotInformation&#39;</span><span class="p">]</span>

        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        FleetManager: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            Connected Robots: </span><span class="si">{</span><span class="n">fleetrobotinformation</span><span class="p">[</span><span class="s1">&#39;Robots&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            Completed Jobs: </span><span class="si">{</span><span class="n">jobcounts</span><span class="p">[</span><span class="s1">&#39;CompletedJobs&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            Pending Jobs:   </span><span class="si">{</span><span class="n">queueinformation</span><span class="p">[</span><span class="s1">&#39;QueueSizePending&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            Cancelled Jobs: </span><span class="si">{</span><span class="n">jobcounts</span><span class="p">[</span><span class="s1">&#39;CancelledJobs&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            SetNetGo Ver.:  </span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="s1">&#39;SNG&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            ARAM Ver.:      </span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="s1">&#39;ARAM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></div>


<div class="viewcode-block" id="Robot"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot">[docs]</a><span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="n">MasterAMR</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class describing an Autonomous Mobile Robot.</span>

<span class="sd">    This class is the class the user should use to communicate with an Autonomous</span>
<span class="sd">    Mobile Robot.</span>
<span class="sd">    Use the Robot objects to access status, IO, configuration, datastore, job queue</span>
<span class="sd">    and other useful data or to request new jobs, modify configuration parameters,</span>
<span class="sd">    force IO values, and command the Robot directly with methods like dock and goto.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        IP_address (:py:class:`str`): The IP address of the appliance, inserted as a string.</span>

<span class="sd">        password (:py:class:`str`): The user-created password of the ARCL Telnet server, as</span>
<span class="sd">            defined in MobilePlanner.</span>
<span class="sd">            **Default**: adept</span>
<span class="sd">        </span>
<span class="sd">        commport (:py:class:`int`): The port used by the appliance to communicate through ARCL.</span>
<span class="sd">            **Default**: 7171</span>

<span class="sd">        loglevel (:py:class:`str`): String that represents the log level requested for the object.</span>
<span class="sd">            Possible values are &#39;debug&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;error&#39;, &#39;critical&#39;.</span>
<span class="sd">            **Default**: INFO level.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_setinitialvalues_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="n">lastIPdigits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="p">[</span><span class="n">find_nth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RobotLog_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;RB</span><span class="si">{</span><span class="n">lastIPdigits</span><span class="si">}</span><span class="s1">.log&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="p">)</span>

    <span class="c1"># Returns status...</span>
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">strtonum</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span><span class="p">):</span>
            <span class="n">string_list</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
                <span class="n">num_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_list</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
                <span class="n">num_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_list</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type specified not correct&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">num_list</span>
        
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">)</span>
        
        <span class="n">status_string</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Status:&#39;</span><span class="p">))</span>
        <span class="n">stateofcharge_string</span> <span class="o">=</span> <span class="n">strtonum</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;StateOfCharge:&#39;</span><span class="p">)))</span>
        <span class="n">location_string</span> <span class="o">=</span> <span class="n">strtonum</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Location:&#39;</span><span class="p">)),</span> <span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="n">localizationscore_string</span> <span class="o">=</span> <span class="n">strtonum</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;LocalizationScore:&#39;</span><span class="p">)))</span>
        <span class="n">temperature_string</span> <span class="o">=</span> <span class="n">strtonum</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Temperature:&#39;</span><span class="p">)))</span>
        
        <span class="n">status_obj</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="n">status_string</span><span class="p">,</span> <span class="n">stateofcharge_string</span><span class="p">,</span> <span class="n">location_string</span><span class="p">,</span> <span class="n">localizationscore_string</span><span class="p">,</span> <span class="n">temperature_string</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">status_obj</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:attr:`~PyARCL.Status`: Returns a Status object containing informations</span>
<span class="sd">        about the robot status.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the status request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested status&#39;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstatus</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getinputlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;inputlist&#39;</span><span class="p">)</span>
            <span class="n">inputlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;InputList&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;End of InputList</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">inputlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">inputlist</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing all the names of the inputs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the inputlist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested inputlist&#39;</span><span class="p">)</span>
        <span class="n">inputlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getinputlist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inputlist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputlist</span>
    
    <span class="k">def</span> <span class="nf">__getinputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">InputDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputlist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`~PyARCL.InputDict`: Container acting as a dictionary of input values.</span>
<span class="sd">        </span>
<span class="sd">        Keys are the input names, which can be accessed through the :py:attr:`~PyARCL.Robot.inputlist`</span>
<span class="sd">        property. Allows iteration.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the inputs request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested inputs&#39;</span><span class="p">)</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getinputs</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputs</span>
    
    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">__getoutputlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;outputlist&#39;</span><span class="p">)</span>
            <span class="n">outputlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;OutputList&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">readstring</span> <span class="o">==</span> <span class="s1">&#39;End of OutputList</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">outputlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">outputlist</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outputlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;:py:class:`list` of :py:class:`str`: List containing all the names of the outputs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the outputlist request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested outputlist&#39;</span><span class="p">)</span>
        <span class="n">outputlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getoutputlist</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputlist</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputlist</span>
    
    <span class="k">def</span> <span class="nf">__getoutputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OutputDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputlist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Container acting as a dictionary of output values.</span>

<span class="sd">        Keys are the output names, which can be accessed through the :py:attr:`~PyARCL.Robot.outputlist`</span>
<span class="sd">        property. Allows iteration. Outputs can be set to a boolean to force</span>
<span class="sd">        their value in the real robot.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the outputs request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Requested outputs&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getoutputs</span><span class="p">()</span>
        <span class="c1"># Logging the returned value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">==</span> <span class="s1">&#39;ultradebug&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Returned </span><span class="si">{</span><span class="n">slm</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">outputs</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outputs</span>
    
<div class="viewcode-block" id="Robot.queueDropoff"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.queueDropoff">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">queueDropoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">missiongoal</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">customjobid</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generates a dropoff mission to the AMR/FM and returns the :py:class:`~PyARCL.Job` object </span>
<span class="sd">        related to said mission. Note that this is the only queue command available</span>
<span class="sd">        to a robot connected to a Fleet Manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            missiongoal (:py:class:`str`): The mission goal the dropoff job segment should</span>
<span class="sd">                be requesting.</span>

<span class="sd">            priority (:py:class:`int`): The priority of the dropoff job segment.</span>
<span class="sd">                **Default**: The default dropoff priority as defined in config.</span>
<span class="sd">            </span>
<span class="sd">            customjobid (:py:class:`str`): the custom id to give to the job.</span>
<span class="sd">                **Default**: The default names ARAM assigns to the jobs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the queueDropoff attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to use queueDropoff for the goal &quot;</span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">default_dropoff_priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Queuing Manager&#39;</span><span class="p">][</span><span class="s1">&#39;DefaultDropoffPriority&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Check if Robot is connected to a Fleet Manager, skip exception in case</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">EM_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Enterprise Manager Connection&#39;</span><span class="p">][</span><span class="s1">&#39;ConnectToEnterpriseManager&#39;</span><span class="p">]</span>
                <span class="n">default_dropoff_priority</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Default dropoff priority of default config</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">EM_connection</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">EM_connection</span><span class="p">:</span>
                <span class="c1"># Logging the exception</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Robot or FleetManager does not have Queuing Manager active&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">missiongoal</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoal&quot; parameter must be a string&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;missiongoal&quot; parameter must be a string&#39;</span><span class="p">)</span>

        <span class="c1"># For speed reasons &#39;self.goallist&#39; is assigned by reference to &#39;goallist&#39;</span>
        <span class="c1"># local variable.</span>
        <span class="n">goallist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span>
        <span class="k">if</span> <span class="n">missiongoal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goallist</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Goal &quot;</span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&quot; not in map&#39;</span><span class="p">)</span>

        <span class="n">commandstring</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;queuedropoff </span><span class="si">{</span><span class="n">missiongoal</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">priority</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">customjobid</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">priority</span><span class="p">:</span>
                <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">default_dropoff_priority</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">commandstring</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">customjobid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commandstring</span><span class="p">)</span>
        
        <span class="c1"># &#39;queuedropoff&#39; and only &#39;queuedropoff&#39; generates this additional line</span>
        <span class="c1"># we must skip for the program to work correctly. That&#39;s just how</span>
        <span class="c1"># it is folks!</span>
        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;queuedropoff attempting to queue goal&#39;</span><span class="p">)</span>
        <span class="c1"># Reading feedback and using it to generate a dictionary of &#39;JobSegment&#39; objects</span>
        <span class="n">readstring</span> <span class="o">=</span> <span class="n">findline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;queuedropoff&#39;</span><span class="p">)</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">idlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="n">jobid</span> <span class="o">=</span> <span class="n">trimmer</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">find_nth</span><span class="p">(</span><span class="n">readstring</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>

        <span class="c1"># Do not return anything if it was a EM-connected robot</span>
        <span class="c1"># NB Add a local version of the dicts so tht you can return objects in this case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">EM_connection</span><span class="p">:</span>
            <span class="n">tempdict</span> <span class="o">=</span> <span class="n">JobSegmentDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">goallist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TL_obj</span><span class="p">,</span> <span class="n">idlist</span><span class="p">,</span> <span class="n">jobid</span><span class="p">,</span> <span class="n">tempdict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TL_requests</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span></div>

    <span class="c1"># From now on, only simple or very simple commands are implemented</span>

<div class="viewcode-block" id="Robot.goto"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.goto">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Method that instructs the robot to go to a map goal.</span>

<span class="sd">        Args:</span>
<span class="sd">            goal (:py:class:`str`): The goal to go to. Will raise exception if goal is</span>
<span class="sd">                not in the list returned by the :py:attr:`~PyARCL.Robot.goallist` property (i.e. not in map).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the goto command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to send robot to &quot;</span><span class="si">{</span><span class="n">goal</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">goal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goallist</span><span class="p">:</span>
            <span class="c1"># Logging exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Cannot go to goal: Goal name not in map&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot go to goal: Goal name not in map&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;goto </span><span class="si">{</span><span class="n">goal</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.executemacro"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.executemacro">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">executemacro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method that instructs the robot to run a macro.</span>

<span class="sd">        Args:</span>
<span class="sd">            macro (:py:class:`str`): Name of the macro to execute.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the executemacro command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to make robot execute macro &quot;</span><span class="si">{</span><span class="n">macro</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;executemacro </span><span class="si">{</span><span class="n">macro</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Robot.dotask"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.dotask">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">dotask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method that instructs the robot to perform a task.</span>

<span class="sd">        Args:</span>
<span class="sd">            task (:py:class:`str`): Name of the task to do.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the dotask command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attempting to make robot do task &quot;</span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;dotask </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.dock"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.dock">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method that instructs the robot to dock.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the dock command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempting to dock the robot&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;dock&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Robot.undock"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.undock">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">undock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method that instructs the robot to undock.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the undock command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempting to undock the robot&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;undock&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Robot.stop"><a class="viewcode-back" href="../PyARCL.html#PyARCL.Robot.stop">[docs]</a>    <span class="nd">@TLrequest</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Method that instructs the robot to stop.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Logging the stop command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Attempting to stop the robot&#39;</span><span class="p">)</span>
        <span class="n">sendcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">[</span><span class="s1">&#39;Versions&#39;</span><span class="p">]</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Enterprise Manager Connection&#39;</span><span class="p">][</span><span class="s1">&#39;Identifier&#39;</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        Robot: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IP_address</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            ID:   </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            Status:</span>
<span class="s1">                Aram Status:         </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">aramstatus</span><span class="si">}</span><span class="s1"></span>
<span class="s1">                State of Charge:     </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">stateofcharge</span><span class="si">}</span><span class="s1"></span>

<span class="s1">                Location:            X: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> [mm], Y: </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> [mm], : </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1"> [deg]</span>
<span class="s1">                Localization Score:  </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">locscore</span><span class="si">}</span><span class="s1"></span>

<span class="s1">                CPU Temperature:     </span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">temperature</span><span class="si">}</span><span class="s1"></span>

<span class="s1">            SetNetGo Ver.:  </span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="s1">&#39;SNG&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            ARAM Ver.:      </span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="s1">&#39;ARAM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">            MARC Ver.:      </span><span class="si">{</span><span class="n">versions</span><span class="p">[</span><span class="s1">&#39;MARC&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">description</span><span class="p">)</span></div>

<span class="c1"># %%</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Marco Zangrandi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>